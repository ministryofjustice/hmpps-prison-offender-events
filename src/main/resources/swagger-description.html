<h2>Generate events for the offender changes in prison</h2>
<p>Background service for generating events for the <b>hmpps-domain-events</b> topic from DPS and NOMIS changes
  indicating a change to an offender in prison</p>
<p>
  Events are generated when this service detects a change in NOMIS/DPS via hmpps-prisoner-events or when a service
  determines a significant event has happened.
</p>
<p>
  The events published to the <b>offender-events</b> topic tend to be events closely related the database tables that
  have been updated and are often fine grained.
</p>
<p>
  The events published to the <b>hmpps-domain-events</b> topic tend to be coarse grained business events to better
  represent the real world changes.
</p>
<h3>Prison specific events - <b>offender-events</b> topic</h3>
<div>
  <p>
    These are generated by hmpps-prisoner-events and are published to the <b>offender-events</b> topic.
    Metadata about the event included as a SQS Message Attribute is as follows:
  </p>
  <ul>
    <li><b>eventType</b> see below for all event types - this is also included in the message</li>
    <li><b>code</b> optional code that represents either the Alert Code for alerts of the movement Type with direction
      for events that contain movements
    </li>
    <li><b>publishedAt</b> the zoned ISO offset timestamp when this event was published e.g 2020-12-04T10:42:43+01:00,
      2020-12-04T10:42:43Z
    </li>
  </ul>
  Note that other teams should not be listening to events from the <b>offender-events</b> topic. If they are interested
  in events generated from NOMIS then they should modify this project instead to create a new <b>hmpps-domain-events</b>
  event.
</div>
<h3>HMPPS domain events - <b>hmpps-domain-events</b> topic</h3>
<div>
  This service receives prison events from hmpps-prisoner-events and other services and converts them, publishing them
  to the <b>hmpps-domain-events</b> topic.
  <p>
    Please see the event docs linked from the <a href="https://github.com/ministryofjustice/prison-offender-events">
    repository README</a> for information on each event that is generated by this service.
  </p>
</div>
<h2>Topic subscription</h2>
<p>Clients are expected to use a SQS AWS queue to receive events with queue subscribed to <b>prison-events-topic</b> or
  <b>hmpps-domain-topic</b> or both. </p>
<p>Clients can subscribe to one or more events. A typical subscription could be:</p>
<pre>
    resource "aws_sns_topic_subscription" "my_probation_subscription" {
    provider      = aws.london
    topic_arn     = module.hmpps-domain-events.topic_arn
    protocol      = "sqs"
    endpoint      = module.my_queue.sqs_arn
    filter_policy = "{\"eventType\":[ \"prison-offender-events.prisoner.released\", \"prison-offender-events.prisoner.receive\", \"prison-offender-events.prisoner.merged\"] }"
    }
</pre>
<p>and this would be defined in the Cloud Platform hmpps-domain-events namespace or the offender-events namespace for
  <b>offender_events</b></p>
